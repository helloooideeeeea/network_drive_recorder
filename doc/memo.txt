
sudo tee -a /etc/systemd/system/video-record.service > /dev/null << EOT
[Unit]
Description=Start Video Record
After=default.target
Wants=default.target

[Service]
User=pi
Group=pi
Environment=WORK_DIR=/home/pi/network_drive_recorder
WorkingDirectory=${WORK_DIR}
ExecStart=/usr/bin/python video-record.py
Restart=always
Type=simple
StandardOutput=file:${WORK_DIR}/tmp/record_stdout.log
StandardError=file:${WORK_DIR}/tmp/record_stderr.log

[Install]
WantedBy=default.target
EOT

sudo /usr/bin/systemctl daemon-reload
sudo /usr/bin/systemctl enable video-record.service

sudo tee -a /etc/systemd/system/web-server.service > /dev/null << EOT
[Unit]
Description=Start Web Server
After=default.target
Wants=default.target

[Service]
User=pi
Group=pi
Environment=WORK_DIR=/home/pi/network_drive_recorder
EnvironmentFile=${WORK_DIR}/enviroments
WorkingDirectory=${WORK_DIR}
ExecStart=/usr/bin/python -m flask --app web-server.py run
Restart=always
Type=simple
StandardOutput=file:${WORK_DIR}/tmp/server_stdout.log
StandardError=file:${WORK_DIR}/tmp/server_stderr.log

[Install]
WantedBy=default.target
EOT

sudo /usr/bin/systemctl daemon-reload
sudo /usr/bin/systemctl enable web-server.service


gst-launch-1.0 libcamerasrc ! videoconvert ! videoscale ! clockoverlay time-format="%D %H:%M:%S" ! v4l2h264enc ! 'video/x-h264,level=(string)4' ! h264parse ! mpegtsmux name=mux ! hlssink max-files=0 target-duration=10 location=/home/pi/www/hls/segment%05d.ts playlist-location=/home/pi/www/hls/playlist.m3u8 sync=false